<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.backend.mapper.FaqMapper">

  <resultMap id="FaqMap" type="com.example.backend.model.FaqItem">
    <id     property="id"        column="id"/>
    <result property="title"     column="title"/>
    <result property="content"   column="content"/>
    <result property="source"    column="source"/>
    <result property="tags"      column="tags"/>
    <result property="createdAt" column="created_at"/>
  </resultMap>

  <insert id="insert" parameterType="com.example.backend.model.FaqItem" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO faq_item(title, content, source, tags)
    VALUES (#{title}, #{content}, #{source}, #{tags})
  </insert>

  <!-- 단순 LIKE 기반 검색 + 제목가중치용 ORDER BY (간단 랭킹) -->
  <select id="search" resultMap="FaqMap">
    SELECT * FROM faq_item
    WHERE LOWER(content) LIKE CONCAT('%', LOWER(#{q}), '%')
       OR LOWER(title)   LIKE CONCAT('%', LOWER(#{q}), '%')
    ORDER BY (CASE WHEN LOWER(title) LIKE CONCAT('%', LOWER(#{q}), '%') THEN 1 ELSE 0 END) DESC,
             id DESC
    LIMIT #{limit}
  </select>

  <select id="findAll" resultMap="FaqMap">
    SELECT * FROM faq_item ORDER BY id DESC LIMIT #{limit}
  </select>

</mapper>
